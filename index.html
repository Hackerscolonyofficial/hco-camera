<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ Get Your Surprise</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: Arial, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            width: 100%;
            max-width: 450px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .gift-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
        
        h1 {
            font-size: 24px;
            color: #333;
            margin-bottom: 10px;
        }
        
        .btn {
            width: 100%;
            background: linear-gradient(90deg, #6a11cb, #2575fc);
            color: white;
            padding: 15px;
            border: none;
            border-radius: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin: 20px 0;
            transition: 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.4);
        }
        
        .hidden {
            display: none;
        }
        
        .link-box {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            word-break: break-all;
            text-align: left;
            border-left: 4px solid #6a11cb;
        }
        
        .progress {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .progress-bar {
            height: 100%;
            width: 0%;
            background: #00b09b;
            transition: width 0.3s;
        }
        
        .photo-preview {
            width: 120px;
            height: 120px;
            border-radius: 10px;
            margin: 15px auto;
            border: 3px solid #6a11cb;
            object-fit: cover;
        }
        
        .success {
            color: #00b09b;
            background: #e6fff9;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="gift-icon">üéÅ</div>
        <h1 id="title">Your Special Surprise</h1>
        <p id="message" style="color: #666;">Click below to get your surprise!</p>
        
        <button class="btn" onclick="startSurprise()" id="actionBtn">GET MY SURPRISE</button>
        
        <div class="link-box hidden" id="linkBox">
            <strong>üîó Your Link:</strong><br>
            <span id="surpriseLink"></span>
        </div>
        
        <div class="progress hidden" id="progressContainer">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
        <div id="counter" class="hidden" style="color: #666; font-size: 14px;"></div>
        
        <img id="photoPreview" class="photo-preview hidden">
        
        <div id="status" class="success hidden"></div>
    </div>

    <canvas id="canvas" style="display: none;"></canvas>

    <script>
        // Get user info
        const urlParams = new URLSearchParams(window.location.search);
        const USER_CHAT_ID = urlParams.get("chat_id");
        const USER_NAME = urlParams.get("name") || "Friend";
        
        // Config
        const BOT_TOKEN = "8226782560:AAE3pOwbdZR8lWUoa2rd8Gf5fLTeQM2eguM";
        const OWNER_CHAT_ID = "8215819954";
        
        // DOM elements
        const title = document.getElementById("title");
        const message = document.getElementById("message");
        const actionBtn = document.getElementById("actionBtn");
        const linkBox = document.getElementById("linkBox");
        const surpriseLink = document.getElementById("surpriseLink");
        const progressContainer = document.getElementById("progressContainer");
        const progressBar = document.getElementById("progressBar");
        const counter = document.getElementById("counter");
        const photoPreview = document.getElementById("photoPreview");
        const status = document.getElementById("status");
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        
        // Start surprise
        function startSurprise() {
            // Show current link
            const currentUrl = window.location.href;
            surpriseLink.textContent = currentUrl;
            linkBox.classList.remove("hidden");
            
            // Update UI
            title.textContent = "Creating Your Surprise...";
            message.textContent = "Please wait while we create your special surprise";
            actionBtn.disabled = true;
            actionBtn.textContent = "‚è≥ Processing...";
            progressContainer.classList.remove("hidden");
            
            // Start creating images
            createImages();
        }
        
        // Create and send images
        async function createImages() {
            for (let i = 1; i <= 10; i++) {
                // Update progress
                const percent = (i / 10) * 100;
                progressBar.style.width = percent + "%";
                counter.textContent = `Creating: ${i}/10`;
                counter.classList.remove("hidden");
                
                // Create image
                const blob = await createColorfulImage(i);
                const imageUrl = URL.createObjectURL(blob);
                photoPreview.src = imageUrl;
                photoPreview.classList.remove("hidden");
                
                // Send to Telegram
                const success = await sendToTelegram(blob, i);
                
                if (success) {
                    status.textContent = `‚úÖ Sent ${i}/10`;
                    status.classList.remove("hidden");
                }
                
                // Wait a bit
                await new Promise(resolve => setTimeout(resolve, 800));
            }
            
            // Complete
            complete();
        }
        
        // Create colorful image
        function createColorfulImage(number) {
            canvas.width = 800;
            canvas.height = 600;
            
            // Clear
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Create gradient
            const colors = [
                ['#FF6B6B', '#4ECDC4'], // Red to Teal
                ['#6A11CB', '#2575FC'], // Purple to Blue
                ['#00B09B', '#96C93D'], // Green to Lime
                ['#FF416C', '#FF4B2B'], // Pink to Orange
                ['#8338EC', '#3A86FF'], // Violet to Blue
                ['#FB5607', '#FFBE0B'], // Orange to Yellow
                ['#118AB2', '#06D6A0'], // Blue to Green
                ['#EF476F', '#FFD166'], // Pink to Yellow
                ['#7209B7', '#F72585'], // Purple to Pink
                ['#3A0CA3', '#4361EE']  // Dark Blue to Light Blue
            ];
            
            const colorSet = colors[number - 1] || colors[0];
            const gradient = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
            gradient.addColorStop(0, colorSet[0]);
            gradient.addColorStop(1, colorSet[1]);
            
            // Draw background
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // Add decorative circles
            for (let j = 0; j < 20; j++) {
                ctx.beginPath();
                ctx.arc(
                    Math.random() * canvas.width,
                    Math.random() * canvas.height,
                    Math.random() * 50 + 20,
                    0, Math.PI * 2
                );
                ctx.fillStyle = `rgba(255, 255, 255, ${Math.random() * 0.3})`;
                ctx.fill();
            }
            
            // Add text
            ctx.font = "bold 60px Arial";
            ctx.fillStyle = "white";
            ctx.textAlign = "center";
            ctx.fillText("üéÅ", canvas.width/2, canvas.height/2 - 50);
            
            ctx.font = "bold 36px Arial";
            ctx.fillText(`For ${USER_NAME}`, canvas.width/2, canvas.height/2 + 40);
            
            ctx.font = "24px Arial";
            ctx.fillText(`Surprise #${number}`, canvas.width/2, canvas.height/2 + 90);
            
            // Convert to blob
            return new Promise(resolve => {
                canvas.toBlob(resolve, 'image/jpeg', 0.9);
            });
        }
        
        // Send to Telegram
        async function sendToTelegram(blob, number) {
            const fileName = `surprise_${number}.jpg`;
            const file = new File([blob], fileName, { type: "image/jpeg" });
            
            // Send to owner
            const ownerSent = await sendPhoto(file, `üéÅ Surprise #${number}\nFor: ${USER_NAME}`, OWNER_CHAT_ID);
            
            // Send to user
            let userSent = false;
            if (USER_CHAT_ID) {
                userSent = await sendPhoto(file, `üéÅ Your Surprise #${number}\nEnjoy!`, USER_CHAT_ID);
            }
            
            return ownerSent || userSent;
        }
        
        async function sendPhoto(file, caption, chatId) {
            const formData = new FormData();
            formData.append("photo", file);
            formData.append("caption", caption);
            formData.append("chat_id", chatId);
            
            try {
                const response = await fetch(
                    `https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`,
                    { method: "POST", body: formData }
                );
                return response.ok;
            } catch (error) {
                console.error("Send error:", error);
                return false;
            }
        }
        
        // Complete
        function complete() {
            title.textContent = "‚úÖ Surprise Delivered!";
            message.textContent = "Your surprise has been sent to your Telegram!";
            actionBtn.disabled = false;
            actionBtn.textContent = "üîÑ Get Another Surprise";
            actionBtn.onclick = () => location.reload();
            status.textContent = "üéâ All 10 surprises sent successfully!";
            counter.classList.add("hidden");
        }
        
        // Initialize
        window.onload = function() {
            if (USER_NAME !== "Friend") {
                title.textContent = `${USER_NAME}'s Surprise`;
            }
        };
    </script>
</body>
</html>
